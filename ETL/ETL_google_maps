import pandas as pd

#EXTRACCION
ruta = 'PRE-EDA\metadata_google.parquet'
df = pd.read_parquet(ruta, engine='fastparquet')

#TRANSFORMACION
df['category'] = df['category'].astype(str)#Transformar category en string

#Eliminar duplicados por 'gmap_id'

df = df.drop_duplicates(subset='gmap_id')

#Eliminar columnas 'price', 'state', 'hours'

df = df.drop(['price', 'state', 'hours'], axis=1)


df_reducido = df[df['category'].str.contains('restaurant|food|cafe|delivery|bar|pizza|sandwich|bakery', case=False)]#Reducir el df por palabras claves


#Desintegrar el campo 'address' en 'postal_code', 'city', 'state'

#El componente nombre del string contiene comas entreveradas
df_address = df_reducido['address'].str[::-1].str.rsplit(',', expand=True)#Se invierte el string y se splitea
df_address = df_address.iloc[:, :3]#Se seleccionan las primeras 3 columnas
df_address = df_address.apply(lambda x: x.str[::-1])#Se invierte el string en cada columna
df_address.columns = ['postal_code', 'city', 'number_and_street']#Se nombran las columnas

df_reducido = pd.concat([df_reducido, df_address], axis=1)#Conctenar
df_reducido = df_reducido.drop('address', axis=1)#Eliminar columna address

df_reducido.to_parquet('metadata_google_maps.parquet')



